<html>
<head>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.0.8/aframe/build/aframe-ar.js"></script>
  <style>
    #scoreBar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 50px;
      background-color: #333;
      color: white;
      font-size: 20px;
      text-align: center;
      line-height: 50px;
    }
    .transparent {
      opacity: 0.5;
    }
    .dialog {
      border-radius: 10px;
      width: 300px; /* Setze die Breite des Dialogs */
      height: auto; /* Setze die Höhe des Dialogs auf automatisch, um den Inhalt anzupassen */
      text-align: center; /* Zentriere den Text */
    }
    .dialog p {
      margin-bottom: 20px; /* Füge etwas Abstand zwischen Überschrift und Text hinzu */
    }
    .dialog ul {
      list-style-type: none; /* Entferne die Aufzählungszeichen */
      padding: 0; /* Entferne den Abstand innerhalb der Liste */
    }
    .dialog ul li {
      margin-bottom: 10px; /* Füge etwas Abstand zwischen den Antworten hinzu */
      display: inline-block; /* Mache die Antwortmöglichkeiten inline */
    }
    .dialog .answers-row {
      display: block; /* Mache die Zeilen der Antworten block */
    }
    .dialog .answers-row ul li:nth-child(odd) {
      margin-right: 20px; /* Füge den Antwortmöglichkeiten A und C 20px Abstand hinzu */
    }
  </style>
  <script>
    var score = 0; // Anfangspunktestand
    var answered = {}; // Objekt, um den Antwortstatus für jedes Objekt zu speichern
    var startDialogShown = false; // Flag, um zu überprüfen, ob der Startdialog gezeigt wurde
    var currentInstruction = 1; // Initialisierung von currentInstruction

    function nextInstruction() {
      var currentDiv = document.getElementById('instruction' + currentInstruction);
      currentDiv.style.display = 'none';
      currentInstruction++;
      var nextDiv = document.getElementById('instruction' + currentInstruction);
      if (nextDiv) {
        nextDiv.style.display = 'block';
      } else {
        startGame();
      }
    }

    window.startGame = function () {
      var startDialog = document.getElementById('startDialog');
      startDialog.parentNode.removeChild(startDialog);
    };

    AFRAME.registerComponent('change-color-and-show-dialog', {
      init: function () {
        var el = this.el;  // Referenz zum aktuellen Element
        el.classList.add('transparent'); // Objekte transparent machen

        // Startdialog anzeigen, wenn Seite geladen wird
        if (!startDialogShown) {
          showStartDialog();
        }

        // Festlegen der spezifischen Frage für jedes Objekt
        var questions = {
          image1: {
            question: "Was ist 2+2?",
            answers: ["A: 3", "B: 4", "C: 5", "D: 6"],
            correctAnswer: "B"
          },
          image2: {
            question: "Was ist die Hauptstadt von Deutschland?",
            answers: ["A: London", "B: Rom", "C: Paris", "D: Berlin"],
            correctAnswer: "D"
          },
          image3: {
            question: "Was ist die Hauptstadt von Spanien?",
            answers: ["A: London", "B: Rom", "C: Madrid", "D: Berlin"],
            correctAnswer: "C"
          },
          image4: {
            question: "Was ist die Hauptstadt von Italien?",
            answers: ["A: London", "B: Rom", "C: Paris", "D: Berlin"],
            correctAnswer: "B"
          },
          image5: {
            question: "Was ist auf dem Bild zu sehen?",
            answers: ["A: Eine Kugel", "B: Ein Würfel", "C: Ein Zylinder", "D: Ein Bild"],
            correctAnswer: "D"
          },
          image6: {
            question: "Wie viele Ecken hat ein Würfel?",
            answers: ["A: 4", "B: 6", "C: 8", "D: 12"],
            correctAnswer: "C"
          }
        };

        var timer; // Timer-Variable

        el.addEventListener('mouseenter', function () {
          // Starte den Timer, wenn der Cursor das Objekt betritt
          timer = setTimeout(function() {
            // Zeigen Sie den Dialog mit der spezifischen Frage für dieses Objekt an, nach Ablauf der Zeit
            if (!answered[el.id] || !answered[el.id].answered) {
              showDialog(questions[el.id]);
            }
          }, 2000); // Hier kannst du die Zeit in Millisekunden anpassen (hier: 1,5 Sekunden)
        });

        function showDialog(questionObj) {
          var dialogHTML = `
            <div id="dialog" class="dialog" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 20px; border: 1px solid black;">
              <h2>Frage:</h2>
              <p>${questionObj.question}</p>
              <div class="answers-row">
                <ul>
                  ${questionObj.answers.slice(0, 2).map(answer => `<li><button onclick="checkAnswer('${answer.charAt(0)}', '${questionObj.correctAnswer}', '${el.id}')">${answer}</button></li>`).join('')}
                </ul>
              </div>
              <div class="answers-row">
                <ul>
                  ${questionObj.answers.slice(2).map(answer => `<li><button onclick="checkAnswer('${answer.charAt(0)}', '${questionObj.correctAnswer}', '${el.id}')">${answer}</button></li>`).join('')}
                </ul>
              </div>
            </div>
          `;
          document.body.insertAdjacentHTML('beforeend', dialogHTML);
        }

        // Funktion zum Überprüfen der Antwort
        window.checkAnswer = function (selectedAnswer, correctAnswer, objectId) {
          if (!answered[objectId]) {
            answered[objectId] = { answered: true };
          }
          if (selectedAnswer === correctAnswer) {
            score++; // Erhöhe den Punktestand um 1, wenn die Antwort richtig ist
          }

          var obj = document.getElementById(objectId);
          obj.setAttribute('material', 'opacity', 0.5);
          updateScore(); // Aktualisiere den Punktestand
          closeDialog();
        };

        // Funktion zum Schließen des Dialogs
        function closeDialog() {
          var dialog = document.getElementById('dialog');
          dialog.parentNode.removeChild(dialog);
        }

        // Funktion zum Aktualisieren des Punktestands
        function updateScore() {
          var scoreElement = document.getElementById('score');
          scoreElement.textContent = "Punktestand: " + score;
        }

        // Startdialog anzeigen -->
        function showStartDialog() {
          startDialogShown = true;
          var startDialogHTML = `
          <div id="startDialog" class="dialog" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: white; padding: 20px; border: 1px solid black;">
            <h2>Willkommen zum Museumsbesuch-Simulator!</h2>
            <div id="instruction1">
              <p>1. Starten des Spiels: Klicke auf "Weiter", um das Spiel zu starten.</p>
              <button onclick="nextInstruction()">Weiter</button>
            </div>
            <div id="instruction2" style="display: none;">
              <p>2. Erkundung des Museums: Bewege deinen Cursor über die verschiedenen Objekte im Museum, um mehr über sie zu erfahren.</p>
              <button onclick="nextInstruction()">Weiter</button>
            </div>
            <div id="instruction3" style="display: none;">
              <p>3. Interaktion mit den Objekten: Halte deinen Cursor für zwei Sekunden über einem Objekt, um eine Frage dazu zu erhalten.</p>
              <button onclick="nextInstruction()">Weiter</button>
            </div>
            <div id="instruction4" style="display: none;">
              <p>4. Beantwortung der Fragen: Wähle die richtige Antwort aus den angebotenen Optionen aus.</p>
              <button onclick="nextInstruction()">Weiter</button>
            </div>
            <div id="instruction5" style="display: none;">
              <p>5. Sammeln von Punkten: Für jede richtige Antwort erhältst du Punkte, die deinen Gesamtpunktestand erhöhen.</p>
              <button onclick="nextInstruction()">Weiter</button>
            </div>
            <div id="instruction6" style="display: none;">
              <p>6. Weiter zur nächsten Station: Erkunde das gesamte Museum, indem du alle Objekte besuchst und ihre Fragen beantwortest.</p>
              <button onclick="nextInstruction()">Weiter</button>
            </div>
            <div id="instruction7" style="display: none;">
              <p>7. Abschluss des Besuchs: Beende das Spiel und sammle so viele Punkte wie möglich!</p>
              <button onclick="startGame()">Spiel Starten</button>
            </div>
          </div>
          `;
          document.body.insertAdjacentHTML('beforeend', startDialogHTML);
        }
      }
    });
  </script>
</head>
<body>
<div id="scoreBar"> <!-- Score-Bar am oberen Rand -->
  <span id="score">Punktestand: 0</span>
</div>
<a-scene embedded arjs='sourceType: webcam;'>
  <!-- Benutzerdefinierte Marker -->
  <a-marker id="marker6" type="pattern" url="marker\pattern-A_Marker.patt">
    <a-plane src="images/first_1.png" height="1.5" width="3" position="0 0 0" rotation="-90 0 0" id="image1" material="side: double;" change-color-and-show-dialog="raycastable"></a-plane>
  </a-marker>
  <a-marker id="marker5" type="pattern" url="marker\pattern-B_Marker.patt">
    <a-plane src="images/first_2.png" height="1.5" width="3" position="0 0 0" rotation="-90 0 0" id="image2" material="side: double;" change-color-and-show-dialog="raycastable"></a-plane>
  </a-marker>
  <a-marker id="marker1" type="pattern" url="marker\pattern-C_Marker.patt">
    <a-plane src="images/first_3.png" height="1.5" width="3" position="0 0 0" rotation="-90 0 0" id="image3" material="side: double;" change-color-and-show-dialog="raycastable"></a-plane>
  </a-marker>
  <a-marker id="marker4" type="pattern" url="marker\pattern-D_Marker.patt">
    <a-plane src="images/first_4.png" height="1.5" width="3" position="0 0 0" rotation="-90 0 0" id="image4" material="side: double;" change-color-and-show-dialog="raycastable"></a-plane>
  </a-marker>
  <a-marker id="marker3" type="pattern" url="marker\pattern-E_Marker.patt">
    <a-plane src="images/first_5.png" height="1.5" width="3" position="0 0 0" rotation="-90 0 0" id="image5" material="side: double;" change-color-and-show-dialog="raycastable"></a-plane>
  </a-marker>
  <a-marker id="marker2" type="pattern" url="marker\pattern-F_Marker.patt">
    <a-plane src="images/first_6.png" height="1.5" width="3" position="0 0 0" rotation="-90 0 0" id="image6" material="side: double;" change-color-and-show-dialog="raycastable"></a-plane>
  </a-marker>
  <!-- Kamera mit Cursor und Raycaster -->
  <a-camera-static raycaster="objects: .raycastable">
    <a-cursor></a-cursor>
  </a-camera-static>
</a-scene>
</body>
</html>
