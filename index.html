<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.0.8/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/aframe-dialog-popup-component/dist/aframe-dialog-popup-component.min.js"></script>
  </head>
  <style>
    #scoreBar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 50px;
      background-color: #333;
      color: white;
      font-size: 20px;
      text-align: center;
      line-height: 50px;
    }
  </style>
  <body>
    <div id="scoreBar">
      <span id="score">Fragen <span id="totalQuestions"></span>/<span id="questionsSoFare"></span> - Richtig beantwortet: <span id="correctAnswers"></span>
    </div>
    <a-scene embedded arjs='sourceType: webcam;' antialias="true" renderer="logarithmicDepthBuffer: true">
      <a-assets>
        <a-asset-item id="scene" src="gltf/scene.gltf"></a-asset-item>
      </a-assets>

       <!-- Marker start -->
       <a-marker id="marker-start" type="pattern" url="marker\pattern-C_Marker.patt">
        <!-- Platzhalter für die Spielanleitung -->
        <a-text class="instruction" value="0" color="white" rotation="-90 0 0" scale="2 2 2" position="0 0 0"></a-text>
        <a-box class="next-instruction" scale="0.05 0.05 0.05" width="4" height="4" depth="4" color="blue" position="1 0 0" next material="opacity: 0.5">
          <a-text value="Next" rotation="-90 0 0" scale="4 4 4" position="-2.2 0 0" width="10" height="10" color="black" font-weight="bold"></a-text>
        </a-box>
        <a-box class="back-instruction" scale="0.05 0.05 0.05" width="4" height="4" depth="4" color="blue" position="0 0 0" back material="opacity: 0.5">
          <a-text value="Back" rotation="-90 0 0" scale="4 4 4" position="-2.2 0 0" width="10" height="10" color="black" font-weight="bold"></a-text>
        </a-box>
      </a-marker>

      <!-- Marker 1 -->
      <a-marker id="marker" type="pattern" url="marker\pattern-A_Marker.patt">
        <a-gltf-model src="#scene" scale="1 1 1" rotation="-90 0 0" position="0 0.2 0" id="image" material="side: double;" cursor-listener></a-gltf-model>
        <a-text value="Autor:" position="0.7 0 -0.5" rotation="-90 0 0" color="white"></a-text>

        <!-- Antwortobjekte, die zunächst unsichtbar sind -->
        <a-box class="false-answer"  scale="0.05 0.05 0.05" width="0" height="0" depth="0" color="green" position="-0.55 0.5 0.55" material="opacity: 0.5" right-answer>
          <a-text class="answer" value="A" rotation="-90 0 0" scale="4 4 4" position="-2.2 0 0" width="10" height="10" color="black" font-weight="bold" visible="false"></a-text>
        </a-box>
        <a-box class="false-answer"  scale="0.05 0.05 0.05" width="0" height="0" depth="0" color="red" position="0.1 0.5 0.55" material="opacity: 0.5" false-answer>
          <a-text class="answer" value="B" rotation="-90 0 0" scale="4 4 4" position="-2.2 0 0" width="10" height="10" color="black" font-weight="bold" visible="false"></a-text>
        </a-box>
        <a-box class="false-answer"  scale="0.05 0.05 0.05" width="0" height="0" depth="0" color="blue" position="-0.55 0.5 0.9" material="opacity: 0.5" false-answer>
          <a-text class="answer" value="C" rotation="-90 0 0" scale="4 4 4" position="-2.2 0 0" width="10" height="10" color="black" font-weight="bold" visible="false"></a-text>
        </a-box>
        <a-box class="false-answer"  scale="0.05 0.05 0.05" width="0" height="0" depth="0" color="yellow" position="0.1 0.5 0.9" material="opacity: 0.5" false-answer>
          <a-text class="answer" value="D" rotation="-90 0 0" scale="4 4 4" position="-2.2 0 0" width="10" height="10" color="black" font-weight="bold" visible="false"></a-text>
        </a-box>
        <a-plane class="plane" position="0 0 -1.1" width="0" height="0" color="#ffffff" rotation="-90 0 0" opacity="0.8">
          <a-text class="question" value="Frankreich?" position="100 0 0" color="black"></a-text>
        </a-plane>
      </a-marker>

      <a-marker id="marker1" type="pattern" url="marker\pattern-B_Marker.patt">
        <a-gltf-model src="#scene" scale="1 1 1" rotation="-90 0 0" position="0 0.2 0" id="image1" material="side: double;" cursor-listener></a-gltf-model>
        <a-text value="Autor:" position="0.7 0 -0.5" rotation="-90 0 0" color="black"></a-text>

        <!-- Antwortobjekte, die zunächst unsichtbar sind -->
        <a-box class="false-answer"  scale="0.05 0.05 0.05" width="0" height="0" depth="0" color="green" position="-0.55 0.5 0.55" material="opacity: 0.5" right-answer>
          <a-text class="answer" value="A" rotation="-90 0 0" scale="4 4 4" position="-2.2 0 0" width="10" height="10" color="black" font-weight="bold" visible="false"></a-text>
        </a-box>
        <a-box class="false-answer"  scale="0.05 0.05 0.05" width="0" height="0" depth="0" color="red" position="0.1 0.5 0.55" material="opacity: 0.5" false-answer>
          <a-text class="answer" value="B" rotation="-90 0 0" scale="4 4 4" position="-2.2 0 0" width="10" height="10" color="black" font-weight="bold" visible="false"></a-text>
        </a-box>
        <a-box class="false-answer"  scale="0.05 0.05 0.05" width="0" height="0" depth="0" color="blue" position="-0.55 0.5 0.9" material="opacity: 0.5" false-answer>
          <a-text class="answer" value="C" rotation="-90 0 0" scale="4 4 4" position="-2.2 0 0" width="10" height="10" color="black" font-weight="bold" visible="false"></a-text>
        </a-box>
        <a-box class="false-answer"  scale="0.05 0.05 0.05" width="0" height="0" depth="0" color="yellow" position="0.1 0.5 0.9" material="opacity: 0.5" false-answer>
          <a-text class="answer" value="D" rotation="-90 0 0" scale="4 4 4" position="-2.2 0 0" width="10" height="10" color="black" font-weight="bold" visible="false"></a-text>
        </a-box>
        <a-plane class="plane" position="0 0 -1.1" width="0" height="0" color="#ffffff" rotation="-90 0 0" opacity="0.8">
          <a-text class="question" value="Frankreich?" position="100 0 0" color="black"></a-text>
        </a-plane>

        <a-plane class="plane" position="0 0 -1.1" width="0" height="0" color="#ffffff" rotation="-90 0 0" opacity="0.8">
          <a-text class="question" value="Frankreich?" position="100 0 0" color="black"></a-text>
        </a-plane>
      </a-marker>

      <a-camera-static raycaster="objects: .raycastable">
        <a-cursor
          animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 1 1 1"
          animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 1500; from: 1 1 1; to: 0.1 0.1 0.1"
          animation__mouseleave="property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 500; to: 1 1 1"
          fuse="true"
          fuse-timeout="1500"
          material="color: yellow; shader: flat"
          position="0 0 -2"
          geometry="primitive: ring">
        </a-cursor>
      </a-camera-static>
    </a-scene>

    <script>
           var currentIndex = 0;
      AFRAME.registerComponent('next', {
        init: function(){
          var el = this.el;
          var markerId = el.parentNode.getAttribute('id');
          var instructions = ["1", "2", "3", "4"]
          
          el.addEventListener('click', function(){
            var marker = document.querySelector('#' + markerId);
            if(currentIndex === instructions.length){
              marker.querySelectorAll('.instruction, .next-instruction').forEach(function(obj) {
                obj.parentNode.removeChild(obj);
        });
            }
      if (marker) {
        marker.querySelectorAll('.instruction').forEach(function(obj) {
          obj.setAttribute('value', instructions[currentIndex]);
        });
        currentIndex++;
            }
          })
        }
      });

  AFRAME.registerComponent('back', {
    init: function(){
      var el = this.el;
      var markerId = el.parentNode.getAttribute('id');
      var instructions = ["0", "1", "2", "3"]; // Die Anweisungen sollten hier korrekt sein, basierend auf der Anzahl der Anweisungen im Array.

      el.addEventListener('click', function(){
        var marker = document.querySelector('#' + markerId);
        if(currentIndex === 0){ // Wenn der Index bereits bei 0 ist, beende die Funktion
          return;
        }
        currentIndex--;
        if (marker) {
          marker.querySelectorAll('.instruction').forEach(function(obj) {
            obj.setAttribute('value', instructions[currentIndex]);
          });
        }
      });
    }
  });
</script>

    <script>
      var correctAnswers = 0;
      var totalQuestions = 6;
      var questionsSoFare = 0;
      var modelClicked = false;
      var modelClicked1 = false;

      function updateScoreText() {
        var scoreElement = document.getElementById('score');
        scoreElement.textContent = `Fragen ${totalQuestions}/${questionsSoFare} - Richtig beantwortet: ${correctAnswers}`;
      }

      AFRAME.registerComponent('false-answer', {
  init: function() {
    var el = this.el;
    var markerId = el.parentNode.getAttribute('id'); // ID des Elternelements

    // Füge einen Event-Listener für das 'click'-Ereignis auf das Modell hinzu
    el.addEventListener('click', function() {
      questionsSoFare++;
      updateScoreText();
      // Überprüfe, ob das aktuelle Modell innerhalb eines a-marker mit der entsprechenden ID ist
      var marker = document.querySelector('#' + markerId);
      if (marker) {
        // Nur die Antwortobjekte innerhalb des aktuellen a-marker sichtbar machen
        marker.querySelectorAll('.false-answer, .right-answer, .plane, .question, .answer').forEach(function(obj) {
          obj.parentNode.removeChild(obj);
        });
      }
    });
  }
});

      AFRAME.registerComponent('right-answer', {
  init: function() {
    var el = this.el;
    var markerId = el.parentNode.getAttribute('id'); // ID des Elternelements

    // Füge einen Event-Listener für das 'click'-Ereignis auf das Modell hinzu
    el.addEventListener('click', function() {

      // Überprüfe, ob das aktuelle Modell innerhalb eines a-marker mit der entsprechenden ID ist
      questionsSoFare++;
      correctAnswers++;
      updateScoreText();
      var marker = document.querySelector('#' + markerId);
      if (marker) {
        // Nur die Antwortobjekte innerhalb des aktuellen a-marker sichtbar machen
        marker.querySelectorAll('.false-answer, .right-answer, .plane, .question .answer').forEach(function(obj) {
          obj.parentNode.removeChild(obj);
        });
      }
    });
  }
});

AFRAME.registerComponent('cursor-listener', {
  init: function() {
    var el = this.el;
    var markerId = el.parentNode.getAttribute('id'); // ID des Elements, auf das die Komponente angewendet wird

    // Füge einen Event-Listener für das 'click'-Ereignis auf das Modell hinzu
    el.addEventListener('click', function() {

      // Überprüfe, ob das aktuelle Modell innerhalb eines a-marker mit der entsprechenden ID ist
      var marker = document.querySelector('#' + markerId);
      if (marker) {
        // Alle Antwortobjekte innerhalb des aktuellen a-marker sichtbar machen
        marker.querySelectorAll('.false-answer, .right-answer, .plane, .question .answer').forEach(function(obj) {
          // Überprüfe, ob es sich um eine Box handelt
          if (obj.tagName === 'A-BOX') {
            // Setze die Größe der Box
            obj.setAttribute('width', '4');
            obj.setAttribute('height', '4');
            obj.setAttribute('depth', '4');
            var children = obj.children;
            // Jetzt kannst du auf die Kinder zugreifen und sie manipulieren
            for (var i = 0; i < children.length; i++) {
              var child = children[i];
              child.setAttribute('visible', 'true');
            }
          }
          if(obj.tagName === 'A-PLANE'){
            obj.setAttribute('width', '3');
            obj.setAttribute('height', '1');
            var children = obj.children;
            // Jetzt kannst du auf die Kinder zugreifen und sie manipulieren
            for (var i = 0; i < children.length; i++) {
              var child = children[i];
              child.setAttribute('position', '0 0 -1.1');
            }
          }
        });
      }
    });
  }
});

      document.getElementById('totalQuestions').textContent = totalQuestions;
      document.getElementById('questionsSoFare').textContent = questionsSoFare;
      document.getElementById('correctAnswers').textContent = correctAnswers;
    </script>
  </body>
</html>
